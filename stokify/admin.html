<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kelola Produk - Stokify Admin</title>
  <link rel="stylesheet" href="style.css">
  <style>
    #crudForm { display: none; border: 1px solid #ccc; padding: 15px; max-width: 400px; margin-top: 15px; background: #fff; border-radius: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    tr:hover { background-color: #f9f9f9; cursor: pointer; }
    button { margin: 5px; }
    #addBtn { margin-bottom: 15px; }
  </style>
</head>
<body>
  <div class="profile-container">
    <div class="header-text">
      <h2>Kelola Produk</h2>
      <button id="addBtn">Tambah Produk</button>

      <table>
        <thead>
          <tr><th>ID</th><th>Nama</th><th>Deskripsi</th><th>Harga</th><th>Gambar</th></tr>
        </thead>
        <tbody id="dataBody"></tbody>
      </table>

      <form id="crudForm">
        <input type="hidden" id="recordId" />
        <label>Nama Produk:</label><br>
        <input type="text" id="nameInput" required><br>

        <label>Deskripsi:</label><br>
        <textarea id="descInput" required></textarea><br>

        <label>Harga (Rp):</label><br>
        <input type="number" id="priceInput" required><br>

        <label>URL Gambar:</label><br>
        <input type="url" id="imageInput" required><br>

        <button type="submit">Simpan</button>
        <button type="button" id="deleteBtn">Hapus</button>
        <button type="button" id="cancelBtn">Batal</button>
      </form>
    </div>
  </div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
const supabase = createClient('https://tfvzsriecpzvrnzlvwww.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmdnpzcmllY3B6dnJuemx2d3d3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1NTc5NzMsImV4cCI6MjA2NTEzMzk3M30.z1OHvDg0kkgyzmaW_BIho4tTHCXfFXSSH-KjYrPosOg')

const dataBody = document.getElementById('dataBody')
const addBtn = document.getElementById('addBtn')
const crudForm = document.getElementById('crudForm')
const recordId = document.getElementById('recordId')
const nameInput = document.getElementById('nameInput')
const descInput = document.getElementById('descInput')
const priceInput = document.getElementById('priceInput')
const imageInput = document.getElementById('imageInput')
const deleteBtn = document.getElementById('deleteBtn')
const cancelBtn = document.getElementById('cancelBtn')

async function loadData() {
  const { data } = await supabase.from('web').select('*').order('id')
  dataBody.innerHTML = ''
  data.forEach(row => {
    const tr = document.createElement('tr')
    tr.innerHTML = `<td>${row.id}</td><td>${row.nama}</td><td>${row.deskripsi}</td><td>${row.harga}</td><td><img src="${row.gambar}" width="50"></td>`
    tr.onclick = () => showForm(row)
    dataBody.appendChild(tr)
  })
}

function showForm(data=null) {
  crudForm.style.display = 'block'
  if (data) {
    recordId.value = data.id
    nameInput.value = data.nama
    descInput.value = data.deskripsi
    priceInput.value = data.harga
    imageInput.value = data.gambar
    deleteBtn.style.display = 'inline-block'
  } else {
    recordId.value = ''
    crudForm.reset()
    deleteBtn.style.display = 'none'
  }
}

function hideForm() {
  crudForm.style.display = 'none'
  crudForm.reset()
}

crudForm.onsubmit = async (e) => {
  e.preventDefault()
  const data = {
    nama: nameInput.value.trim(),
    deskripsi: descInput.value.trim(),
    harga: parseInt(priceInput.value),
    gambar: imageInput.value.trim()
  }
  const id = recordId.value
  if (id) await supabase.from('web').update(data).eq('id', id)
  else await supabase.from('web').insert([data])
  hideForm(); loadData()
}

deleteBtn.onclick = async () => {
  if (!confirm('Yakin hapus?')) return
  await supabase.from('web').delete().eq('id', recordId.value)
  hideForm(); loadData()
}

cancelBtn.onclick = hideForm
addBtn.onclick = () => showForm()
window.addEventListener('DOMContentLoaded', loadData)
</script>
</body>
</html>
